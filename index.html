<!DOCTYPE html>
<html>
<head>
  <title>The BG Challenge</title>
  <style>
    body {
      background-color: #252a34;
      color: #ffffff;
      font-family: 'Courier New', Courier, monospace;
      text-align: center;
    }

    h1 {
      font-size: 36px;
      margin-top: 50px;
    }

    #score {
      font-size: 24px;
      margin-top: 20px;
    }

    #letters {
      font-size: 24px;
      margin-top: 20px;
    }

    #requiredLetter {
      font-size: 18px;
      margin-top: 10px;
      font-weight: bold;
    }

    #letterButtons {
      margin-top: 30px;
    }

    .letterButton {
      display: inline-block;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background-color: #61dafb;
      margin: 5px;
      line-height: 50px;
      font-size: 20px;
      color: #ffffff;
      cursor: pointer;
    }

    .letterButton.required {
      background-color: #ff8080;
    }

    #shuffleButton {
      margin-top: 20px;
    }

    #submissionBox {
      margin-top: 30px;
    }

    #submitButton {
      margin-top: 10px;
    }

    #wordsLeft {
      font-size: 18px;
      margin-top: 30px;
    }

    #submittedWords {
      font-size: 18px;
      margin-top: 30px;
      text-align: left;
      white-space: pre;
    }

    #cheatSheetButton {
      margin-top: 20px;
    }

    #cheatSheet {
      font-size: 18px;
      margin-top: 30px;
      text-align: left;
      white-space: pre;
    }
  </style>
</head>
<body>
  <h1>The BG Challenge</h1>
  <p id="score">Score: <span id="scoreValue">0</span></p>
  <p id="letters"></p>
  <p id="requiredLetter"></p>
  <div id="letterButtons"></div>
  <button id="shuffleButton">Shuffle Letters</button>
  <div id="submissionBox">
    <input type="text" id="wordInput" placeholder="Enter a word">
    <button id="submitButton">Submit</button>
  </div>
  <p id="wordsLeft">Words Left: <span id="wordsLeftValue">0</span></p>
  <p id="submittedWords"></p>
  <button id="cheatSheetButton">Toggle Cheat Sheet</button>
  <div id="cheatSheet"></div>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
    var combinationList = [];
    var wordList = [];
    var letters = "";
    var requiredLetter = "";
    var score = 0;
    var wordsLeft = 0;
    var submittedWords = [];
	
	function TrieNode() {
	  this.children = {};
	  this.isEndOfWord = false;
	}

	function Trie() {
	  this.root = new TrieNode();
	}

	Trie.prototype.addWord = function(word) {
	  var current = this.root;
	  for (var i = 0; i < word.length; i++) {
		var char = word[i];
		if (!current.children[char]) {
		  current.children[char] = new TrieNode();
		}
		current = current.children[char];
	  }
	  current.isEndOfWord = true;
	};

	Trie.prototype.getWordsWithLetters = function(letters, allowDuplicates) {
	  var results = [];
	  var current = this.root;
	  var visited = {};

	  function search(node, word) {
		if (node.isEndOfWord && (allowDuplicates || !visited[word])) {
		  results.push(word);
		  visited[word] = true;
		}

		for (var char in node.children) {
		  if (letters.includes(char)) {
			var index = letters.indexOf(char);
			letters = letters.slice(0, index) + letters.slice(index + 1);
			search(node.children[char], word + char);
			letters = letters.slice(0, index) + char + letters.slice(index);
		  }
		}
	  }

	  search(current, "");

	  return results;
	};

	function fetchWordList(callback) {
	  $.get("https://raw.githubusercontent.com/OkayHero/WordGame/main/wordlist.txt", function(data) {
		wordList = data.trim().split("\n");
		if (callback) {
		  callback();
		}
	  });
	}

    function fetchCombinationList(callback) {
	  $.get("https://raw.githubusercontent.com/OkayHero/WordGame/main/combinations.txt", function(data) {
		var lines = data.trim().split("\n");
		combinationList = lines.map(function(line) {
		  var parts = line.split(" ");
		  return {
			letters: parts[0].toUpperCase(),
			requiredLetter: parts[1].toUpperCase()
		  };
		});
		generateLetters();
		if (callback) {
		  callback();
		}
	  });
	}

    function generateLetters() {
      var combination = combinationList[Math.floor(Math.random() * combinationList.length)];
      letters = combination.letters;
      requiredLetter = combination.requiredLetter;
      updateLetters();
      generateCheatSheet();
    }

	function updateLetters() {
	  var lettersHTML = "";
	  for (var i = 0; i < letters.length; i++) {
		var letter = letters[i];
		var buttonClass = "letterButton";
		if (letter === requiredLetter) {
		  buttonClass += " required";
		}
		lettersHTML += '<button class="' + buttonClass + '">' + letter + '</button>';
	  }
	  $("#letters").html(lettersHTML);
	  $("#requiredLetter").text("Required Letter: " + requiredLetter);
	  setupLetterButtons();
	}

    function setupLetterButtons() {
      $(".letterButton").click(function() {
        var letter = $(this).text();
        $("#wordInput").val($("#wordInput").val() + letter);
      });
    }

    function shuffleLetters() {
      var shuffledLetters = letters.split("").sort(function() {
        return 0.5 - Math.random();
      }).join("");
      letters = shuffledLetters;
      updateLetters();
    }

    function submitWord() {
      var word = $("#wordInput").val().trim().toUpperCase();
      if (word.length >= 4 && word.includes(requiredLetter) && isWordPossible(word) && !submittedWords.includes(word)) {
        submittedWords.push(word);
        updateSubmittedWords();
        score += word.length;
        $("#scoreValue").text(score);
        $("#wordInput").val("");
      }
    }

    function updateSubmittedWords() {
      var wordsHTML = "";
      for (var i = 0; i < submittedWords.length; i++) {
        wordsHTML += submittedWords[i] + "\n";
      }
      $("#submittedWords").text(wordsHTML);
    }

    // Check if a word can be formed using the given letters
	function isWordPossible(word) {
	  var lettersCopy = letters.slice(); // Create a copy of the letters array
	  for (var i = 0; i < word.length; i++) {
		var letterIndex = lettersCopy.indexOf(word[i]);
		if (letterIndex !== -1) {
		  lettersCopy.splice(letterIndex, 1); // Remove the used letter from the copy
		} else {
		  return false; // Letter not found, word is not possible
		}
	  }
	  return true; // All letters of the word are found
	}

	// Generate the list of possible words based on the combination list
	function generatePossibleWords() {
	  var possibleWords = wordList.filter(function (word) {
		return word.length >= 4 && word.includes(requiredLetter) && !submittedWords.includes(word);
	  });

	  return possibleWords;
	}
	
	// Generate all possible combinations of the given letters
	function generateCombinations(letters) {
	  var combinations = [];
	  var lettersArr = letters.split("");
	  for (var i = 0; i < lettersArr.length; i++) {
		combinations.push(lettersArr[i]);
		for (var j = i + 1; j < lettersArr.length; j++) {
		  combinations.push(lettersArr[i] + lettersArr[j]);
		  for (var k = j + 1; k < lettersArr.length; k++) {
			combinations.push(lettersArr[i] + lettersArr[j] + lettersArr[k]);
			for (var l = k + 1; l < lettersArr.length; l++) {
			  combinations.push(lettersArr[i] + lettersArr[j] + lettersArr[k] + lettersArr[l]);
			}
		  }
		}
	  }
	  return combinations;
	}

	function generateCheatSheet() {
	  var possibleWords = generatePossibleWords();
	  console.log("Possible Words:", possibleWords); // Debug statement
	  $("#cheatSheet").text(possibleWords.join("\n"));
	  wordsLeft = possibleWords.length;
	  console.log("Words Left:", wordsLeft); // Debug statement
	  $("#wordsLeftValue").text(wordsLeft);
	}
	
	generateCheatSheet();
	
    $(document).ready(function() {
	  fetchWordList(function() {
        fetchCombinationList();
      });
      fetchCombinationList();
      $("#shuffleButton").click(function() {
        shuffleLetters();
      });
      $("#submitButton").click(function() {
        submitWord();
      });
      $("#wordInput").keypress(function(event) {
        if (event.which === 13) {
          submitWord();
        }
      });
      $("#cheatSheetButton").click(function() {
        $("#cheatSheet").toggle();
      });
    });
  </script>
</body>
</html>
